<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browse Inventory - PitSpot Auto</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="inventory-style.css">
  <style>
    /* ==================== ADMIN PANEL STYLES ==================== */
    .admin-fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(230, 57, 70, 0.4);
      transition: all 0.3s ease;
      z-index: 999;
      border: none;
    }

    .admin-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(230, 57, 70, 0.6);
    }

    .admin-fab.hidden {
      display: none;
    }

    /* Admin Modal */
    .admin-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      z-index: 10000;
      overflow-y: auto;
      padding: 20px;
    }

    .admin-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .admin-modal-content {
      background: white;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Modal Header */
    .admin-modal-header {
      background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
      color: white;
      padding: 24px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 16px 16px 0 0;
    }

    .admin-modal-header h2 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
    }

    .admin-close-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: white;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .admin-close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    /* Modal Body */
    .admin-modal-body {
      padding: 30px;
    }

    /* Admin Login Form */
    .admin-login-form {
      max-width: 400px;
      margin: 0 auto;
    }

    .admin-login-form h3 {
      text-align: center;
      margin-bottom: 24px;
      color: #333;
      font-size: 20px;
    }

    .admin-form-group {
      margin-bottom: 20px;
    }

    .admin-form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    .admin-form-group input,
    .admin-form-group select,
    .admin-form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .admin-form-group input:focus,
    .admin-form-group select:focus,
    .admin-form-group textarea:focus {
      outline: none;
      border-color: #e63946;
      box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
    }

    .admin-form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* File Upload Area */
    .file-upload-area {
      border: 2px dashed #e0e0e0;
      border-radius: 12px;
      padding: 40px 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: #f8f9fa;
    }

    .file-upload-area:hover {
      border-color: #e63946;
      background: #fff5f6;
    }

    .file-upload-area.dragover {
      border-color: #e63946;
      background: #fff5f6;
      transform: scale(1.02);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .upload-text {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
    }

    .upload-hint {
      font-size: 12px;
      color: #999;
    }

    #car-images {
      display: none;
    }

    /* Image Preview Grid */
    .image-preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .image-preview-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid #e0e0e0;
      background: #f8f9fa;
    }

    .image-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-image-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 24px;
      height: 24px;
      background: rgba(230, 57, 70, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .remove-image-btn:hover {
      background: #d62828;
      transform: scale(1.1);
    }

    /* Form Actions */
    .admin-form-actions {
      display: flex;
      gap: 12px;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }

    .admin-btn {
      flex: 1;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .admin-btn-primary {
      background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(230, 57, 70, 0.3);
    }

    .admin-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(230, 57, 70, 0.4);
    }

    .admin-btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .admin-btn-secondary {
      background: white;
      color: #666;
      border: 2px solid #e0e0e0;
    }

    .admin-btn-secondary:hover {
      background: #f8f9fa;
      border-color: #ccc;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading-spinner.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #e63946;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Success Message */
    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #c3e6cb;
    }

    .success-message.active {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .error-message {
      display: none;
      background: #f8d7da;
      color: #721c24;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #f5c6cb;
    }

    .error-message.active {
      display: block;
      animation: slideDown 0.3s ease;
    }

    /* Two Column Layout for Form */
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    /* Admin Panel Container */
    .admin-panel {
      display: none;
    }

    .admin-panel.active {
      display: block;
    }

    .admin-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 2px solid #e0e0e0;
    }

    .admin-tab {
      padding: 12px 24px;
      background: none;
      border: none;
      color: #666;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
    }

    .admin-tab.active {
      color: #e63946;
      border-bottom-color: #e63946;
    }

    .admin-tab:hover {
      color: #e63946;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .admin-modal-content {
        margin: 20px;
        max-height: calc(100vh - 40px);
      }

      .admin-modal-body {
        padding: 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .admin-fab {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
        font-size: 20px;
      }

      .image-preview-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo">
      <a href="index.html">
        <img src="assets/logo.png" alt="PitSpot Auto Logo" class="logo-img">
      </a>
    </div>
    <nav class="nav-links">
      <a href="inventory.html" class="nav-link active">Inventory</a>
      <a href="about.html" class="nav-link">About</a>
      <a href="contact.html" class="nav-link">Contact</a>
    </nav>
    <div class="mobile-menu-toggle" id="mobile-menu-toggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </header>

  <!-- PAGE HEADER -->
  <section class="page-header">
    <div class="breadcrumb">
      <a href="index.html">Home</a> > Inventory
    </div>
    <h1 class="page-title">Browse Our Collection</h1>
    <p class="page-subtitle"><span id="total-count">0</span> vehicles available</p>
  </section>

  <!-- MAIN CONTAINER -->
  <div class="main-container">
    <!-- FILTER SIDEBAR (Simplified for brevity) -->
    <aside class="filter-sidebar" id="filter-sidebar">
      <div class="sidebar-header">
        <h2>Filters</h2>
        <button class="close-sidebar" id="close-sidebar">‚úï</button>
      </div>
      <!-- Add your filter sections here -->
    </aside>

    <!-- VEHICLE GRID -->
    <main class="main-content">
      <div class="vehicle-grid" id="vehicle-grid">
        <!-- Vehicle cards will be generated by JavaScript -->
        <div class="loading-spinner active" id="initial-loader">
          <div class="spinner"></div>
          <p>Loading vehicles...</p>
        </div>
      </div>
    </main>
  </div>

  <!-- ADMIN FLOATING ACTION BUTTON -->
  <button class="admin-fab" id="admin-fab" title="Admin Panel">
    üîê
  </button>

  <!-- ADMIN MODAL -->
  <div class="admin-modal" id="admin-modal">
    <div class="admin-modal-content">
      <div class="admin-modal-header">
        <h2>Admin Panel</h2>
        <button class="admin-close-btn" id="admin-close-btn">‚úï</button>
      </div>
      <div class="admin-modal-body">
        <!-- Success/Error Messages -->
        <div class="success-message" id="success-message"></div>
        <div class="error-message" id="error-message"></div>

        <!-- Admin Login Form -->
        <div class="admin-login-form" id="admin-login-form">
          <h3>üîê Admin Login</h3>
          <div class="admin-form-group">
            <label for="admin-email">Email</label>
            <input type="email" id="admin-email" placeholder="info@pitspotautos.com" required>
          </div>
          <div class="admin-form-group">
            <label for="admin-password">Password</label>
            <input type="password" id="admin-password" placeholder="Enter password" required>
          </div>
          <div class="admin-form-actions">
            <button class="admin-btn admin-btn-primary" id="login-btn">
              Login
            </button>
          </div>
        </div>

        <!-- Admin Panel (Hidden until logged in) -->
        <div class="admin-panel" id="admin-panel">
          <div class="admin-tabs">
            <button class="admin-tab active" data-tab="add-vehicle">Add Vehicle</button>
            <button class="admin-tab" data-tab="manage-vehicles">Manage Vehicles</button>
          </div>

          <!-- Add Vehicle Tab -->
          <div class="admin-tab-content active" id="add-vehicle-tab">
            <form id="add-vehicle-form">
              <div class="form-row">
                <div class="admin-form-group">
                  <label for="car-make">Make *</label>
                  <input type="text" id="car-make" placeholder="e.g., Toyota" required>
                </div>
                <div class="admin-form-group">
                  <label for="car-model">Model *</label>
                  <input type="text" id="car-model" placeholder="e.g., Camry" required>
                </div>
              </div>

              <div class="form-row">
                <div class="admin-form-group">
                  <label for="car-year">Year *</label>
                  <input type="number" id="car-year" placeholder="2024" min="1990" max="2025" required>
                </div>
                <div class="admin-form-group">
                  <label for="car-price">Price (‚Ç¶) *</label>
                  <input type="number" id="car-price" placeholder="25000000" min="0" required>
                </div>
              </div>

              <div class="form-row">
                <div class="admin-form-group">
                  <label for="car-mileage">Mileage *</label>
                  <input type="number" id="car-mileage" placeholder="15000" min="0" required>
                </div>
                <div class="admin-form-group">
                  <label for="car-color">Color *</label>
                  <input type="text" id="car-color" placeholder="e.g., Black" required>
                </div>
              </div>

              <div class="form-row">
                <div class="admin-form-group">
                  <label for="car-transmission">Transmission *</label>
                  <select id="car-transmission" required>
                    <option value="">Select...</option>
                    <option value="Automatic">Automatic</option>
                    <option value="Manual">Manual</option>
                    <option value="CVT">CVT</option>
                  </select>
                </div>
                <div class="admin-form-group">
                  <label for="car-fuel">Fuel Type *</label>
                  <select id="car-fuel" required>
                    <option value="">Select...</option>
                    <option value="Gasoline">Gasoline</option>
                    <option value="Diesel">Diesel</option>
                    <option value="Hybrid">Hybrid</option>
                    <option value="Electric">Electric</option>
                  </select>
                </div>
              </div>

              <div class="admin-form-group">
                <label for="car-features">Features (comma separated)</label>
                <input type="text" id="car-features" placeholder="Navigation, Leather Seats, Sunroof">
              </div>

              <div class="admin-form-group">
                <label for="car-description">Description</label>
                <textarea id="car-description" placeholder="Enter vehicle description..."></textarea>
              </div>

              <div class="admin-form-group">
                <label>Vehicle Images * (Max 10 images)</label>
                <div class="file-upload-area" id="file-upload-area">
                  <div class="upload-icon">üì∑</div>
                  <div class="upload-text">Click to upload or drag and drop</div>
                  <div class="upload-hint">PNG, JPG, WEBP up to 5MB each</div>
                  <input type="file" id="car-images" accept="image/*" multiple>
                </div>
                <div class="image-preview-grid" id="image-preview-grid"></div>
              </div>

              <div class="loading-spinner" id="upload-spinner">
                <div class="spinner"></div>
                <p>Uploading vehicle...</p>
              </div>

              <div class="admin-form-actions">
                <button type="submit" class="admin-btn admin-btn-primary" id="submit-btn">
                  Add Vehicle
                </button>
                <button type="button" class="admin-btn admin-btn-secondary" id="reset-btn">
                  Reset Form
                </button>
              </div>
            </form>
          </div>

          <!-- Manage Vehicles Tab -->
          <div class="admin-tab-content" id="manage-vehicles-tab" style="display: none;">
            <h3>Manage Vehicles</h3>
            <div id="manage-vehicles-list">
              <p>Loading vehicles...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

  <!-- Firebase Configuration -->
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyDmYv6Iz9yUg0vNMbnlIhsM5TuE7i85IT4",
  authDomain: "pitspot-autos.firebaseapp.com",
  databaseURL: "https://pitspot-autos-default-rtdb.firebaseio.com",
  projectId: "pitspot-autos",
  storageBucket: "pitspot-autos.firebasestorage.app",
  messagingSenderId: "762200572603",
  appId: "1:762200572603:web:1cae2f93a481fe591edf9e",
  measurementId: "G-6DZGZ187KF"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
    const auth = firebase.auth();
  </script>

  <!-- Admin Upload Script -->
  <script>
    
    // ==================== GLOBAL VARIABLES ====================// ========================================
// ADMIN UPLOAD & MANAGEMENT SYSTEM
// Add this to your existing inventory-script.js
// ========================================

// ========================================
// 1. LOAD VEHICLES FROM FIREBASE
// ========================================
async function loadVehiclesFromFirebase() {
  try {
    console.log('üì• Loading vehicles from Firebase...');
    const snapshot = await db.collection('vehicles')
      .where('status', '==', 'active')
      .orderBy('createdAt', 'desc')
      .get();
    
    vehicles.length = 0; // Clear existing array
    
    snapshot.forEach(doc => {
      const data = doc.data();
      vehicles.push({
        id: doc.id,
        make: data.make,
        model: data.model,
        year: data.year,
        price: data.price,
        mileage: data.mileage,
        color: data.color,
        transmission: data.transmission.toLowerCase(),
        fuel: data.fuelType.toLowerCase(),
        images: data.images || [],
        badges: data.badges || [],
        bodyType: data.bodyType || 'sedan',
        features: data.features || [],
        description: data.description || '',
        specs: data.specs || {}
      });
    });
    
    console.log(`‚úÖ Loaded ${vehicles.length} vehicles from Firebase`);
    renderVehicles();
  } catch (error) {
    console.error('‚ùå Error loading vehicles:', error);
    // Continue with default vehicles if Firebase fails
    renderVehicles();
  }
}

// ========================================
// 2. UPLOAD IMAGES TO FIREBASE STORAGE
// ========================================
async function uploadImagesToStorage(files) {
  const uploadedUrls = [];
  
  for (let i = 0; i < files.length; i++) {
    try {
      const file = files[i];
      const timestamp = Date.now();
      const filename = `vehicles/${timestamp}_${i}_${file.name}`;
      const storageRef = storage.ref(filename);
      
      console.log(`üì§ Uploading image ${i + 1}/${files.length}...`);
      const snapshot = await storageRef.put(file);
      const downloadURL = await snapshot.ref.getDownloadURL();
      
      uploadedUrls.push(downloadURL);
      console.log(`‚úÖ Image ${i + 1} uploaded successfully`);
    } catch (error) {
      console.error(`‚ùå Error uploading image ${i + 1}:`, error);
      throw new Error(`Failed to upload image ${i + 1}`);
    }
  }
  
  return uploadedUrls;
}

// ========================================
// 3. ADD NEW VEHICLE TO FIREBASE
// ========================================
async function addVehicleToFirebase(vehicleData) {
  try {
    const docRef = await db.collection('vehicles').add({
      ...vehicleData,
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
      status: 'active'
    });
    
    console.log('‚úÖ Vehicle added with ID:', docRef.id);
    return docRef.id;
  } catch (error) {
    console.error('‚ùå Error adding vehicle:', error);
    throw error;
  }
}

// ========================================
// 4. UPDATE VEHICLE IN FIREBASE
// ========================================
async function updateVehicleInFirebase(vehicleId, vehicleData) {
  try {
    await db.collection('vehicles').doc(vehicleId).update({
      ...vehicleData,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    console.log('‚úÖ Vehicle updated:', vehicleId);
    return true;
  } catch (error) {
    console.error('‚ùå Error updating vehicle:', error);
    throw error;
  }
}

// ========================================
// 5. DELETE VEHICLE FROM FIREBASE
// ========================================
async function deleteVehicleFromFirebase(vehicleId) {
  try {
    // Soft delete - just mark as inactive
    await db.collection('vehicles').doc(vehicleId).update({
      status: 'deleted',
      deletedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    console.log('‚úÖ Vehicle deleted:', vehicleId);
    return true;
  } catch (error) {
    console.error('‚ùå Error deleting vehicle:', error);
    throw error;
  }
}

// ========================================
// 6. DELETE IMAGES FROM STORAGE
// ========================================
async function deleteImageFromStorage(imageUrl) {
  try {
    const imageRef = storage.refFromURL(imageUrl);
    await imageRef.delete();
    console.log('‚úÖ Image deleted from storage');
  } catch (error) {
    console.error('‚ùå Error deleting image:', error);
    // Don't throw - image might not exist
  }
}

// ========================================
// 7. ADMIN MODAL HANDLER
// ========================================
function openAdminUploadModal() {
  const modal = document.createElement('div');
  modal.className = 'vehicle-modal active';
  modal.id = 'admin-upload-modal';
  modal.innerHTML = `
    <div class="modal-overlay" onclick="closeAdminModal()"></div>
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeAdminModal()">‚úï</button>
      
      <div class="modal-header">
        <h2>üöó Add New Vehicle</h2>
      </div>

      <div class="modal-body">
        <div id="admin-success-msg" class="success-message"></div>
        <div id="admin-error-msg" class="error-message"></div>

        <form id="admin-upload-form">
          <!-- Basic Information -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Make *</label>
              <input type="text" id="admin-make" required placeholder="e.g., Toyota">
            </div>
            <div class="form-group">
              <label>Model *</label>
              <input type="text" id="admin-model" required placeholder="e.g., Camry">
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Year *</label>
              <input type="number" id="admin-year" required min="1990" max="2025" placeholder="2024">
            </div>
            <div class="form-group">
              <label>Price (‚Ç¶) *</label>
              <input type="number" id="admin-price" required min="0" placeholder="25000000">
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Mileage *</label>
              <input type="number" id="admin-mileage" required min="0" placeholder="15000">
            </div>
            <div class="form-group">
              <label>Color *</label>
              <input type="text" id="admin-color" required placeholder="e.g., Black">
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Transmission *</label>
              <select id="admin-transmission" required>
                <option value="">Select...</option>
                <option value="Automatic">Automatic</option>
                <option value="Manual">Manual</option>
                <option value="CVT">CVT</option>
              </select>
            </div>
            <div class="form-group">
              <label>Fuel Type *</label>
              <select id="admin-fuel" required>
                <option value="">Select...</option>
                <option value="Gasoline">Gasoline</option>
                <option value="Diesel">Diesel</option>
                <option value="Hybrid">Hybrid</option>
                <option value="Electric">Electric</option>
              </select>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Body Type *</label>
              <select id="admin-body-type" required>
                <option value="">Select...</option>
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="truck">Truck</option>
                <option value="coupe">Coupe</option>
                <option value="van">Van</option>
              </select>
            </div>
            <div class="form-group">
              <label>Badges</label>
              <div style="display: flex; gap: 12px; padding-top: 8px;">
                <label style="display: flex; align-items: center; gap: 6px; font-weight: normal;">
                  <input type="checkbox" id="admin-badge-new" value="new">
                  New
                </label>
                <label style="display: flex; align-items: center; gap: 6px; font-weight: normal;">
                  <input type="checkbox" id="admin-badge-featured" value="featured">
                  Featured
                </label>
                <label style="display: flex; align-items: center; gap: 6px; font-weight: normal;">
                  <input type="checkbox" id="admin-badge-certified" value="certified">
                  Certified
                </label>
              </div>
            </div>
          </div>

          <div class="form-group" style="margin-bottom: 16px;">
            <label>Features (comma separated)</label>
            <input type="text" id="admin-features" placeholder="navigation, leather, sunroof, backup-camera">
          </div>

          <div class="form-group" style="margin-bottom: 16px;">
            <label>Description</label>
            <textarea id="admin-description" rows="3" placeholder="Enter vehicle description..."></textarea>
          </div>

          <!-- Image Upload -->
          <div class="form-group" style="margin-bottom: 16px;">
            <label>Vehicle Images * (3-10 images)</label>
            <div style="border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; background: #f8f9fa;" id="admin-drop-zone">
              <p style="margin: 0; color: #666;">üì∑ Click to upload or drag & drop images</p>
              <p style="margin: 8px 0 0; font-size: 12px; color: #999;">PNG, JPG, WEBP - Max 5MB each</p>
              <input type="file" id="admin-images" accept="image/*" multiple style="display: none;" required>
            </div>
            <div id="admin-image-previews" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; margin-top: 16px;"></div>
          </div>

          <div id="admin-upload-progress" style="display: none; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 16px;">
            <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #e63946; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px;"></div>
            <p style="margin: 0; color: #666; font-weight: 600;">Uploading vehicle...</p>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 24px; padding-top: 16px; border-top: 1px solid #e0e0e0;">
            <button type="submit" id="admin-submit-btn" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #e63946, #d62828); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
              Add Vehicle
            </button>
            <button type="button" onclick="closeAdminModal()" style="flex: 1; padding: 14px; background: white; color: #666; border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  `;

  document.body.appendChild(modal);
  document.body.style.overflow = 'hidden';

  // Initialize file upload handlers
  initAdminFileUpload();
  
  // Form submit handler
  document.getElementById('admin-upload-form').addEventListener('submit', handleAdminUpload);
}

function closeAdminModal() {
  const modal = document.getElementById('admin-upload-modal');
  if (modal) {
    modal.classList.remove('active');
    setTimeout(() => {
      modal.remove();
      document.body.style.overflow = '';
    }, 300);
  }
}

// ========================================
// 8. FILE UPLOAD HANDLERS
// ========================================
let selectedAdminFiles = [];

function initAdminFileUpload() {
  const dropZone = document.getElementById('admin-drop-zone');
  const fileInput = document.getElementById('admin-images');
  
  dropZone.addEventListener('click', () => fileInput.click());
  
  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#e63946';
    dropZone.style.background = '#fff5f6';
  });
  
  dropZone.addEventListener('dragleave', () => {
    dropZone.style.borderColor = '#ccc';
    dropZone.style.background = '#f8f9fa';
  });
  
  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.borderColor = '#ccc';
    dropZone.style.background = '#f8f9fa';
    
    const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
    handleAdminFileSelection(files);
  });
  
  fileInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);
    handleAdminFileSelection(files);
  });
}

function handleAdminFileSelection(files) {
  if (selectedAdminFiles.length + files.length > 10) {
    showAdminError('Maximum 10 images allowed');
    return;
  }
  
  files.forEach(file => {
    if (file.size > 5 * 1024 * 1024) {
      showAdminError(`File ${file.name} is too large (max 5MB)`);
      return;
    }
    selectedAdminFiles.push(file);
  });
  
  renderAdminImagePreviews();
}

function renderAdminImagePreviews() {
  const container = document.getElementById('admin-image-previews');
  container.innerHTML = '';
  
  selectedAdminFiles.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const div = document.createElement('div');
      div.style.cssText = 'position: relative; aspect-ratio: 1; border-radius: 8px; overflow: hidden; border: 2px solid #e0e0e0;';
      div.innerHTML = `
        <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
        <button type="button" onclick="removeAdminImage(${index})" style="position: absolute; top: 4px; right: 4px; width: 24px; height: 24px; background: rgba(230, 57, 70, 0.9); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;">√ó</button>
      `;
      container.appendChild(div);
    };
    reader.readAsDataURL(file);
  });
}

window.removeAdminImage = function(index) {
  selectedAdminFiles.splice(index, 1);
  renderAdminImagePreviews();
};

// ========================================
// 9. HANDLE FORM SUBMISSION
// ========================================
async function handleAdminUpload(e) {
  e.preventDefault();
  
  if (selectedAdminFiles.length < 3) {
    showAdminError('Please upload at least 3 images');
    return;
  }
  
  const submitBtn = document.getElementById('admin-submit-btn');
  const progress = document.getElementById('admin-upload-progress');
  
  submitBtn.disabled = true;
  progress.style.display = 'block';
  
  try {
    // Upload images first
    const imageUrls = await uploadImagesToStorage(selectedAdminFiles);
    
    // Get badges
    const badges = [];
    if (document.getElementById('admin-badge-new').checked) badges.push('new');
    if (document.getElementById('admin-badge-featured').checked) badges.push('featured');
    if (document.getElementById('admin-badge-certified').checked) badges.push('certified');
    
    // Prepare vehicle data
    const vehicleData = {
      make: document.getElementById('admin-make').value,
      model: document.getElementById('admin-model').value,
      year: parseInt(document.getElementById('admin-year').value),
      price: parseInt(document.getElementById('admin-price').value),
      mileage: parseInt(document.getElementById('admin-mileage').value),
      color: document.getElementById('admin-color').value,
      transmission: document.getElementById('admin-transmission').value,
      fuelType: document.getElementById('admin-fuel').value,
      bodyType: document.getElementById('admin-body-type').value,
      features: document.getElementById('admin-features').value.split(',').map(f => f.trim()).filter(f => f),
      description: document.getElementById('admin-description').value,
      images: imageUrls,
      badges: badges,
      specs: {} // Add specs if needed
    };
    
    // Add to Firebase
    await addVehicleToFirebase(vehicleData);
    
    showAdminSuccess('‚úÖ Vehicle added successfully!');
    
    // Reload vehicles
    await loadVehiclesFromFirebase();
    
    // Close modal after delay
    setTimeout(() => {
      closeAdminModal();
      selectedAdminFiles = [];
    }, 2000);
    
  } catch (error) {
    console.error('Upload error:', error);
    showAdminError('Failed to add vehicle: ' + error.message);
    submitBtn.disabled = false;
    progress.style.display = 'none';
  }
}

// ========================================
// 10. EDIT VEHICLE (UPDATED)
// ========================================
async function editVehicle(id) {
  const vehicle = vehicles.find(v => v.id === id);
  if (!vehicle) return;

  closeModal(); // Close details modal if open
  
  const editModal = document.createElement('div');
  editModal.className = 'vehicle-modal active admin-edit-modal';
  editModal.id = 'admin-edit-modal';
  editModal.innerHTML = `
    <div class="modal-overlay" onclick="closeEditModal()"></div>
    <div class="modal-content" style="max-width: 800px;">
      <button class="modal-close" onclick="closeEditModal()">‚úï</button>
      
      <div class="modal-header">
        <h2>‚úèÔ∏è Edit Vehicle</h2>
      </div>

      <div class="modal-body">
        <div id="edit-success-msg" class="success-message"></div>
        <div id="edit-error-msg" class="error-message"></div>

        <form id="edit-vehicle-form">
          <input type="hidden" id="edit-vehicle-id" value="${vehicle.id}">
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Make</label>
              <input type="text" id="edit-make" value="${vehicle.make}" required>
            </div>
            <div class="form-group">
              <label>Model</label>
              <input type="text" id="edit-model" value="${vehicle.model}" required>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Year</label>
              <input type="number" id="edit-year" value="${vehicle.year}" required>
            </div>
            <div class="form-group">
              <label>Price (‚Ç¶)</label>
              <input type="number" id="edit-price" value="${vehicle.price}" required>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Mileage</label>
              <input type="number" id="edit-mileage" value="${vehicle.mileage}" required>
            </div>
            <div class="form-group">
              <label>Color</label>
              <input type="text" id="edit-color" value="${vehicle.color}" required>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div class="form-group">
              <label>Transmission</label>
              <select id="edit-transmission" required>
                <option value="Automatic" ${vehicle.transmission === 'automatic' ? 'selected' : ''}>Automatic</option>
                <option value="Manual" ${vehicle.transmission === 'manual' ? 'selected' : ''}>Manual</option>
                <option value="CVT" ${vehicle.transmission === 'cvt' ? 'selected' : ''}>CVT</option>
              </select>
            </div>
            <div class="form-group">
              <label>Fuel Type</label>
              <select id="edit-fuel" required>
                <option value="Gasoline" ${vehicle.fuel === 'gasoline' ? 'selected' : ''}>Gasoline</option>
                <option value="Diesel" ${vehicle.fuel === 'diesel' ? 'selected' : ''}>Diesel</option>
                <option value="Electric" ${vehicle.fuel === 'electric' ? 'selected' : ''}>Electric</option>
                <option value="Hybrid" ${vehicle.fuel === 'hybrid' ? 'selected' : ''}>Hybrid</option>
              </select>
            </div>
          </div>

          <div class="form-group" style="margin-bottom: 16px;">
            <label>Body Type</label>
            <select id="edit-body-type" required>
              <option value="sedan" ${vehicle.bodyType === 'sedan' ? 'selected' : ''}>Sedan</option>
              <option value="suv" ${vehicle.bodyType === 'suv' ? 'selected' : ''}>SUV</option>
              <option value="truck" ${vehicle.bodyType === 'truck' ? 'selected' : ''}>Truck</option>
              <option value="coupe" ${vehicle.bodyType === 'coupe' ? 'selected' : ''}>Coupe</option>
              <option value="van" ${vehicle.bodyType === 'van' ? 'selected' : ''}>Van</option>
            </select>
          </div>

          <div class="form-group" style="margin-bottom: 16px;">
            <label>Description</label>
            <textarea id="edit-description" rows="3">${vehicle.description || ''}</textarea>
          </div>

          <div id="edit-upload-progress" style="display: none; text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; margin-bottom: 16px;">
            <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #e63946; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 12px;"></div>
            <p style="margin: 0; color: #666; font-weight: 600;">Updating vehicle...</p>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 24px; padding-top: 16px; border-top: 1px solid #e0e0e0;">
            <button type="submit" id="edit-submit-btn" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #e63946, #d62828); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
              Save Changes
            </button>
            <button type="button" onclick="closeEditModal()" style="padding: 14px 24px; background: white; color: #666; border: 2px solid #e0e0e0; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
              Cancel
            </button>
            <button type="button" onclick="confirmDeleteVehicle('${vehicle.id}')" style="padding: 14px 24px; background: #dc3545; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
              Delete
            </button>
          </div>
        </form>
      </div>
    </div>
  `;

  document.body.appendChild(editModal);
  document.body.style.overflow = 'hidden';

  document.getElementById('edit-vehicle-form').addEventListener('submit', handleEditSubmit);
}

async function handleEditSubmit(e) {
  e.preventDefault();
  
  const vehicleId = document.getElementById('edit-vehicle-id').value;
  const submitBtn = document.getElementById('edit-submit-btn');
  const progress = document.getElementById('edit-upload-progress');
  
  submitBtn.disabled = true;
  progress.style.display = 'block';
  
  try {
    const updatedData = {
      make: document.getElementById('edit-make').value,
      model: document.getElementById('edit-model').value,
      year: parseInt(document.getElementById('edit-year').value),
      price: parseInt(document.getElementById('edit-price').value),
      mileage: parseInt(document.getElementById('edit-mileage').value),
      color: document.getElementById('edit-color').value,
      transmission: document.getElementById('edit-transmission').value,
      fuelType: document.getElementById('edit-fuel').value,
      bodyType: document.getElementById('edit-body-type').value,
      description: document.getElementById('edit-description').value
    };
    
    await updateVehicleInFirebase(vehicleId, updatedData);
    
    showEditSuccess('‚úÖ Vehicle updated successfully!');
    
    await loadVehiclesFromFirebase();
    
    setTimeout(() => closeEditModal(), 2000);
    
  } catch (error) {
    console.error('Update error:', error);
    showEditError('Failed to update vehicle: ' + error.message);
    submitBtn.disabled = false;
    progress.style.display = 'none';
  }
}

window.confirmDeleteVehicle = async function(vehicleId) {
  if (!confirm('Are you sure you want to delete this vehicle? This action cannot be undone.')) {
    return;
  }
  
  try {
    const vehicle = vehicles.find(v => v.id === vehicleId);
    
    // Delete images from storage
    if (vehicle && vehicle.images) {
      for (const imageUrl of vehicle.images) {
        await deleteImageFromStorage(imageUrl);
      }
    }
    
    // Delete from Firestore
    await deleteVehicleFromFirebase(vehicleId);
    
    showEditSuccess('‚úÖ Vehicle deleted successfully!');
    
    await loadVehiclesFromFirebase();
    
    setTimeout(() => closeEditModal(), 1500);
    
  } catch (error) {
    console.error('Delete error:', error);
    showEditError('Failed to delete vehicle: ' + error.message);
  }
};

function closeEditModal() {
  const modal = document.getElementById('admin-edit-modal');
  if (modal) {
    modal.classList.remove('active');
    setTimeout(() => {
      modal.remove();
      document.body.style.overflow = '';
    }, 300);
  }
}

// ========================================
// 11. MESSAGE HELPERS
// ========================================
function showAdminSuccess(message) {
  const el = document.getElementById('admin-success-msg');
  if (el) {
    el.textContent = message;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 5000);
  }
}

function showAdminError(message) {
  const el = document.getElementById('admin-error-msg');
  if (el) {
    el.textContent = message;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 5000);
  }
}

function showEditSuccess(message) {
  const el = document.getElementById('edit-success-msg');
  if (el) {
    el.textContent = message;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 5000);
  }
}

function showEditError(message) {
  const el = document.getElementById('edit-error-msg');
  if (el) {
    el.textContent = message;
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 5000);
  }
}

// ========================================
// 12. UPDATE INITIALIZATION
// ========================================
// Replace the existing init() function's admin button section with:
function initializeAdminControls() {
  // Remove old admin toggle button if exists
  const oldBtn = document.getElementById('admin-toggle');
  if (oldBtn) oldBtn.remove();
  
  // Create new admin button
  const adminBtn = document.createElement('button');
  adminBtn.id = 'admin-toggle';
  adminBtn.className = 'admin-toggle-btn';
  adminBtn.innerHTML = '‚ûï Add Vehicle';
  adminBtn.style.cssText = `
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 16px 24px;
    background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
    color: white;
    border: none;
    border-radius: 50px;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(230, 57, 70, 0.4);
    z-index: 999;
    transition: all 0.3s ease;
  `;
  
  adminBtn.addEventListener('mouseenter', () => {
    adminBtn.style.transform = 'translateY(-2px)';
    adminBtn.style.boxShadow = '0 6px 30px rgba(230, 57, 70, 0.6)';
  });
  
  adminBtn.addEventListener('mouseleave', () => {
    adminBtn.style.transform = 'translateY(0)';
    adminBtn.style.boxShadow = '0 4px 20px rgba(230, 57, 70, 0.4)';
  });
  
  adminBtn.onclick = openAdminUploadModal;
  document.body.appendChild(adminBtn);
}

// ========================================
// 13. UPDATE THE MAIN INIT FUNCTION
// ========================================
// Add this to the end of your existing init() function:

// At the end of init() function, replace the admin button code with:
/*
  // Initialize admin controls
  initializeAdminControls();
  
  // Load vehicles from Firebase on startup
  loadVehiclesFromFirebase();
*/

// ========================================
// 14. ADD CSS STYLES (ADD TO YOUR HTML)
// ========================================
const adminStyles = `
<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .success-message {
    display: none;
    background: #d4edda;
    color: #155724;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #c3e6cb;
    animation: slideDown 0.3s ease;
  }
  
  .error-message {
    display: none;
    background: #f8d7da;
    color: #721c24;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #f5c6cb;
    animation: slideDown 0.3s ease;
  }
  
  @keyframes slideDown {
    from { transform: translateY(-10px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  .form-group {
    margin-bottom: 16px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
    font-size: 14px;
  }
  
  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    transition: all 0.3s ease;
  }
  
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #e63946;
    box-shadow: 0 0 0 3px rgba(230, 57, 70, 0.1);
  }
  
  .form-group textarea {
    resize: vertical;
  }
  
  @media (max-width: 768px) {
    .admin-toggle-btn {
      bottom: 20px !important;
      right: 20px !important;
      padding: 12px 20px !important;
      font-size: 14px !important;
    }
  }
</style>
`;

// ========================================
// 15. COMPLETE UPDATED INIT FUNCTION
// ========================================
// Replace your existing init() function with this updated version:

function init() {
  // Add admin styles
  if (!document.getElementById('admin-styles')) {
    const styleEl = document.createElement('div');
    styleEl.id = 'admin-styles';
    styleEl.innerHTML = adminStyles;
    document.head.appendChild(styleEl);
  }
  
  // Load vehicles from Firebase first
  loadVehiclesFromFirebase();
  
  // Initialize mobile menu
  initMobileMenu();

  const priceSlider = document.getElementById('price-slider');
  const priceDisplay = document.getElementById('max-price-display');
  
  if (priceSlider && priceDisplay) {
    priceSlider.addEventListener('input', (e) => {
      const value = parseInt(e.target.value);
      priceDisplay.value = formatPrice(value);
    });
  }

  const searchInput = document.getElementById('search-input');
  if (searchInput) {
    searchInput.addEventListener('input', debounce(() => {
      applyFilters();
    }, 500));
  }

  document.querySelectorAll('.color-swatch').forEach(swatch => {
    swatch.addEventListener('click', () => {
      swatch.classList.toggle('selected');
    });
  });

  document.querySelectorAll('.filter-pill').forEach(pill => {
    pill.addEventListener('click', () => {
      document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
      pill.classList.add('active');
      state.quickFilter = pill.dataset.filter;
      state.currentPage = 1;
      renderVehicles();
    });
  });

  const sortSelect = document.getElementById('sort-select');
  if (sortSelect) {
    sortSelect.addEventListener('change', (e) => {
      state.sortBy = e.target.value;
      state.currentPage = 1;
      renderVehicles();
    });
  }

  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  const mobileFilterBtn = document.getElementById('mobile-filter-btn');
  if (mobileFilterBtn) {
    mobileFilterBtn.addEventListener('click', toggleMobileFilters);
  }

  const closeSidebarBtn = document.getElementById('close-sidebar');
  if (closeSidebarBtn) {
    closeSidebarBtn.addEventListener('click', closeMobileFilters);
  }

  const overlay = document.getElementById('overlay');
  if (overlay) {
    overlay.addEventListener('click', closeMobileFilters);
  }

  const prevBtn = document.getElementById('prev-btn');
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      if (state.currentPage > 1) {
        goToPage(state.currentPage - 1);
      }
    });
  }

  const nextBtn = document.getElementById('next-btn');
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      const filtered = getFilteredVehicles();
      const totalPages = Math.ceil(filtered.length / state.itemsPerPage);
      if (state.currentPage < totalPages) {
        goToPage(state.currentPage + 1);
      }
    });
  }

  // Initialize admin controls
  initializeAdminControls();

  console.log('‚úÖ Inventory page initialized successfully!');
}

// ========================================
// 16. FIREBASE AUTH CHECK (OPTIONAL)
// ========================================
// Add authentication check for admin features
auth.onAuthStateChanged((user) => {
  const adminBtn = document.getElementById('admin-toggle');
  
  if (user) {
    // User is logged in - show admin button
    console.log('‚úÖ Admin authenticated:', user.email);
    if (adminBtn) adminBtn.style.display = 'block';
    state.isAdmin = true;
  } else {
    // No user logged in - hide admin button (or show login)
    console.log('‚ö†Ô∏è No admin authenticated');
    if (adminBtn) {
      // Option 1: Hide button completely
      // adminBtn.style.display = 'none';
      
      // Option 2: Keep button but require login on click
      adminBtn.onclick = () => {
        const email = prompt('Admin Email:');
        const password = prompt('Admin Password:');
        
        if (email && password) {
          auth.signInWithEmailAndPassword(email, password)
            .then(() => {
              alert('‚úÖ Logged in successfully!');
              state.isAdmin = true;
              renderVehicles();
            })
            .catch(error => {
              alert('‚ùå Login failed: ' + error.message);
            });
        }
      };
    }
    state.isAdmin = false;
  }
  
  renderVehicles();
});

// ========================================
// 17. EXPORT/IMPORT FUNCTIONS (BONUS)
// ========================================

// Export all vehicles to JSON (for backup)
async function exportVehiclesToJSON() {
  try {
    const snapshot = await db.collection('vehicles').get();
    const data = [];
    
    snapshot.forEach(doc => {
      data.push({ id: doc.id, ...doc.data() });
    });
    
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `vehicles-backup-${Date.now()}.json`;
    a.click();
    
    console.log('‚úÖ Vehicles exported successfully');
  } catch (error) {
    console.error('‚ùå Export error:', error);
  }
}

// Import vehicles from JSON
async function importVehiclesFromJSON(file) {
  try {
    const text = await file.text();
    const data = JSON.parse(text);
    
    const batch = db.batch();
    
    data.forEach(vehicle => {
      const docRef = db.collection('vehicles').doc();
      batch.set(docRef, vehicle);
    });
    
    await batch.commit();
    
    console.log('‚úÖ Vehicles imported successfully');
    await loadVehiclesFromFirebase();
  } catch (error) {
    console.error('‚ùå Import error:', error);
  }
}

// ========================================
// 18. UTILITY: REFRESH VEHICLES
// ========================================
window.refreshVehicles = async function() {
  console.log('üîÑ Refreshing vehicles...');
  await loadVehiclesFromFirebase();
  console.log('‚úÖ Vehicles refreshed!');
};

// ========================================
// END OF ADMIN UPLOAD SYSTEM
// ========================================

console.log('‚úÖ Admin upload system loaded successfully!');
console.log('üìù Available admin functions:');
console.log('   - openAdminUploadModal() - Add new vehicle');
console.log('   - editVehicle(id) - Edit existing vehicle');
console.log('   - refreshVehicles() - Reload from Firebase');
console.log('   - exportVehiclesToJSON() - Backup vehicles');
console.log('   - importVehiclesFromJSON(file) - Restore vehicles');
  </script>

  <!-- Additional CSS for Vehicle Cards -->
  <style>
    .vehicle-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .vehicle-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .card-image {
      position: relative;
      width: 100%;
      height: 220px;
      overflow: hidden;
      background: #f8f9fa;
    }

    .card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .vehicle-card:hover .card-image img {
      transform: scale(1.1);
    }

    .card-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #e63946;
      color: white;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .card-body {
      padding: 20px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: #333;
      margin-bottom: 12px;
    }

    .card-specs {
      color: #666;
      font-size: 14px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-features {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .feature-tag {
      background: #f8f9fa;
      color: #666;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid #e0e0e0;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
    }

    .card-price {
      font-size: 24px;
      font-weight: 700;
      color: #e63946;
    }

    .card-btn {
      background: #e63946;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-btn:hover {
      background: #d62828;
      transform: scale(1.05);
    }

    .vehicle-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 24px;
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .vehicle-grid {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 16px;
      }

      .card-footer {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .card-btn {
        width: 100%;
      }
    }
  </style>
</body>
</html>